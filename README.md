# README
è¿™é‡Œè®°å½•ç€æˆ‘å†™verilogä»£ç æ—¶çš„ç–‘é—®å’Œå­¦ä¹ ã€‚

## write_ctrl
### å†™ä»£ç çš„é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ  
1. é¦–å…ˆè¦å†™ä¿¡å·ï¼š
  * ğŸ“¥ Inputsï¼ˆæ¥è‡ªå“ªé‡Œï¼Ÿï¼‰
    * å†™æ—¶é’Ÿä¿¡å·ã€æç¤ºï¼šFIFO æ˜¯å¼‚æ­¥çš„ï¼Œå†™å’Œè¯»æ—¶é’Ÿåˆ†å¼€ï¼Œå†™æ§åˆ¶æ¨¡å—ç”¨å“ªä¸ªæ—¶é’Ÿï¼Ÿã€‘
    * å†™ä½¿èƒ½ä¿¡å·ï¼ˆæ˜¯å¦å†™å…¥ï¼‰ã€æç¤ºï¼šè¿™ä¸ªä¿¡å·ç”±å¤–éƒ¨æ¨¡å—æ§åˆ¶ï¼Œç”¨æ¥å†³å®šæ˜¯å¦å°è¯•å†™æ•°æ®ã€‚ã€‘
    * FIFOå·²æ»¡æ ‡å¿—ï¼Ÿã€æç¤ºï¼šå¦‚æœFIFOæ»¡äº†ï¼Œè¿˜èƒ½å†™å—ï¼Ÿè¿™ä¸ªä¿¡æ¯ä»å“ªé‡Œæ¥ï¼Ÿä½ éœ€è¦æ¥æ”¶å®ƒè¿˜æ˜¯è®¡ç®—å®ƒï¼Ÿã€‘
    * è¯»æŒ‡é’ˆï¼ˆåŒæ­¥è¿‡æ¥çš„ï¼‰ã€æç¤ºï¼šä½ æ˜¯å¦éœ€è¦åˆ¤æ–­â€œæ»¡â€ï¼Ÿé‚£ä½ è¦å’Œè°æ¯”è¾ƒï¼Ÿå¼‚æ­¥åŸŸçš„ä¿¡å·å¯ä»¥ç›´æ¥æ¯”è¾ƒå—ï¼Ÿã€‘  
  * ğŸ“¤ Outputsï¼ˆä½ è¦è¾“å‡ºç»™è°ï¼Ÿï¼‰
    * å†™åœ°å€ï¼ˆå†™æŒ‡é’ˆï¼‰ã€æç¤ºï¼šä½ è¦è¾“å‡ºå†™åœ°å€ç»™ RAMï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½è¾“å‡ºä¸€ä¸ªæ ¼é›·ç ç‰ˆæœ¬ç”¨äºè·¨æ—¶é’ŸåŒæ­¥ã€‚ã€‘
    * å†™æŒ‡é’ˆï¼ˆæ ¼é›·ç ï¼‰ã€æç¤ºï¼šå¼‚æ­¥FIFOé€šå¸¸ä¼šè¾“å‡ºä¸€ä¸ªâ€œåŒæ­¥å‹å¥½â€çš„å†™æŒ‡é’ˆç»™è¯»åŸŸã€‚ã€‘
    * æ»¡ä¿¡å·ï¼ˆFIFO fullï¼‰ã€æç¤ºï¼šä½ æ˜¯å¦è¦è®¡ç®— FIFO æ˜¯å¦æ»¡ï¼Ÿæ»¡çš„æ—¶å€™å¤–éƒ¨å°±ä¸è¯¥å†™äº†ã€‚ã€‘

2. æ¥ç€æ˜¯é€»è¾‘
å¼‚æ­¥FIFOçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š
```
                +--------------------+
   wen & ~wfull |                    |
     ---------->+ â‘  wptr_bin         |
                | (è®¡æ•°å™¨é€’å¢é€»è¾‘)    |
                +--------------------+
                         |
                         v
              +---------------------+
              |â‘¡ assign waddr       |
              |waddr = wptr_bin[2:0]|
              +---------------------+
                         |
                         v
              +-----------------------------+
              |â‘¢ assign wptr_gray           |
              |wptr_gray = wptr_bin ^ (>>1) |
              +-----------------------------+
```
* å†™æŒ‡é’ˆï¼ˆäºŒè¿›åˆ¶ï¼‰é€»è¾‘
* å†™åœ°å€è¾“å‡º
* å†™æŒ‡é’ˆçš„æ ¼é›·ç å½¢å¼
### ä¸ºä»€ä¹ˆåœ¨write_ctrl.vä¸­æˆ‘ä½¿ç”¨çš„æ˜¯wireï¼Œè€Œä¸æ˜¯regï¼Ÿ  
å› ä¸ºæ ¹æ®[FIFOåŸºç¡€](https://hauuhang.github.io/2025/04/05/FIFO_Basics/)ä¸­æè¿°ï¼Œæˆ‘æåˆ°*full= {~wptr[3],wptr[2:0]}=={rptr[3:0]}*ï¼Œè¿™æ˜¯ä¸€ç§ç»„åˆé€»è¾‘ï¼Œå°±è¦ç”¨wire
### æ³¢å½¢å›¾
![write_ctrl_tb](image.png)
```
`timescale 1ns/1ps

module tb_write_ctrl;

    reg wclk;
    reg wrst;
    reg wen;
    reg [2:0] rptr_gray_sync;
    wire [2:0] waddr;
    wire [2:0] wptr_gray;
    wire wfull;

    // å®ä¾‹åŒ–
    wirte_ctrl uut(
        .wclk(wclk),
        .wrst(wrst),
        .wen(wen),
        .rptr_gray_sync(rptr_gray_sync),
        .waddr(waddr),
        .wptr_gray(wptr_gray),
        .wfull(wfull)
    );

    // ç”Ÿæˆæ—¶é’Ÿ
    always #5 wclk = ~wclk;

    initial begin
        $dumpfile("wave.vcd"); // ç”Ÿæˆæ³¢å½¢æ–‡ä»¶ (iverilog)
        $dumpvars(0, tb_write_ctrl);

        // åˆå§‹åŒ–
        wclk = 0;
        wrst = 1;
        wen  = 0;
        rptr_gray_sync = 3'b000;

        // å¤ä½ä¸€æ®µæ—¶é—´
        #20;
        wrst = 0;

        // å†™å‡ æ¬¡æ•°æ®
        #10; wen = 1;
        repeat(10) #10;

        // æ¨¡æ‹ŸFIFOæ»¡
        rptr_gray_sync = 3'b110; // å¯ä»¥è°ƒæ•´ä¸ºå’Œwptr_gray_fullä¸€è‡´çš„å€¼ï¼Œè§‚å¯Ÿwfullå˜åŒ–

        // å†™ä½¿èƒ½ç»§ç»­ï¼Œçœ‹æ˜¯å¦è¢«ç¦æ­¢å†™
        repeat(4) #10;

        // ç»“æŸ
        wen = 0;
        #50;
        $finish;
    end
endmodule
```

## read_ctrl
### è¿™ä¸ªæ¨¡å—çš„ä»£ç é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ
å’Œå†™ä»£ç çš„å¾ˆåƒï¼Œå°±å‡ ä¹æŠŠ`w`å˜æˆ`r`å°±è¡Œäº†ï¼Œä¸å¤šèµ˜è¿°

## dual_port_ram
### æˆ‘ä¸å¤ªæ‡‚[7:0]å’Œ[2:0]ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œæˆ‘æƒ³è¦ä¸€ä¸ª8-deepçš„FIFO
åœ¨ Verilog ä¸­ï¼Œ[a:b] æ˜¯ä½å®½å®šä¹‰ï¼Œè¡¨ç¤ºè¿™ä¸ªä¿¡å·æœ‰å¤šå°‘ä½ï¼ˆbitï¼‰
[7:0]	è¡¨ç¤ºä¸€å…±æœ‰ 8 ä½ï¼ˆbitï¼‰	å¯ä»¥è¡¨ç¤º 0 åˆ° 255 çš„æ•°ï¼ˆ1 byteï¼‰
[2:0]	è¡¨ç¤ºä¸€å…±æœ‰ 3 ä½ï¼ˆbitï¼‰	å¯ä»¥è¡¨ç¤º 0 åˆ° 7ï¼ˆ8ä¸ªåœ°å€ï¼‰

### ä¸ºä»€ä¹ˆè¿™ä¸ªé‡Œé¢ä¸ç”¨wrstå’Œrrst
å› ä¸ºè¿™ä¸ªæ¨¡å—åªæ˜¯ä¸€ä¸ª çº¯å­˜å‚¨å™¨ï¼ˆmemoryï¼‰æ¨¡å—ï¼ŒRAM æœ¬èº«æ˜¯ï¼šåŒæ­¥å†™ã€åŒæ­¥è¯»ï¼›æ²¡æœ‰â€œçŠ¶æ€â€éœ€è¦å¤ä½ï¼›è¯»å†™æ“ä½œå…¨é  wen/ren + clk æ§åˆ¶ï¼›æ•°æ®å­˜åœ¨ RAM çš„æ•°ç»„é‡Œï¼ˆå¦‚ mem[0:7]ï¼‰ï¼Œä¸å— reset æ§åˆ¶æ¸…ç©º

### mem[waddr] <= wdata çš„æ„æ€æ˜¯wdataèµ‹å€¼ç»™mençš„waddrä¸­å—ï¼Ÿ
åœ¨ç¡¬ä»¶ä¸­ä½ å¯ä»¥æŠŠ mem[...] çœ‹æˆä¸€ä¸ªå¯ä»¥å­˜å¾ˆå¤šå°å€¼çš„â€œå‚¨ç‰©æŸœâ€ï¼Œwaddr å°±æ˜¯æŸœå­å·ï¼Œwdata æ˜¯ä½ æ”¾è¿›å»çš„ä¸œè¥¿ã€‚

### æ³¢å½¢å›¾
![dual_prot_ram](image-1.png)